### [380. O(1) 时间插入、删除和获取随机元素](https://leetcode-cn.com/problems/insert-delete-getrandom-o1/)

* $HashMap$  可以实现 $O(1)$ 时间插入和删除，但是不能等概率随即返回一项；
* 需要用一个数组与 $HashMap$ 一一对应，插入时插到最后一个位置；删除时将需要删除的元素与最后一个元素进行交换，再删除最后一个位置，防止删除后数组中见出现空的坑，从而不能等概率返回。

```java
class RandomizedSet {
    Map<Integer, Integer> hash;
    List<Integer> nums;
    Random rand = new Random();

    /** Initialize your data structure here. */
    public RandomizedSet() {
        hash = new HashMap<>();
        nums = new ArrayList<>();
    }
    
    /** Inserts a value to the set. Returns true if the set did not already contain the specified element. */
    public boolean insert(int x) {
        if (!hash.containsKey(x)) {
            nums.add(x);
            hash.put(x, nums.size() - 1);
            return true;
        }
        return false;
    }
    
    /** Removes a value from the set. Returns true if the set contained the specified element. */
    public boolean remove(int x) {
        if (hash.containsKey(x)) {
            int y = nums.get(nums.size() - 1);
            int px = hash.get(x);
            nums.set(px, y);
            hash.put(y, px);
            nums.remove(nums.size() - 1);
            hash.remove(x);
            return true;
        }
        return false;
    }
    
    /** Get a random element from the set. */
    public int getRandom() {
        return nums.get(rand.nextInt(nums.size()));
    }
}
```

### [381. O(1) 时间插入、删除和获取随机元素 - 允许重复](https://leetcode-cn.com/problems/insert-delete-getrandom-o1-duplicates-allowed/)

```java
class RandomizedCollection {
    /** Initialize your data structure here. */
    HashMap<Integer,Set<Integer>> hash;
    List<Integer> nums;
    Random rand = new Random();
    public RandomizedCollection() {
        hash = new HashMap<>();
        nums = new ArrayList<>();
    }

    /** Inserts a value to the collection. Returns true if the collection did not already contain the specified element. */
    public boolean insert(int x) {
       boolean ans = hash.containsKey(x) ;       
       Set<Integer> y = hash.getOrDefault(x, new HashSet<>());       
       y.add(nums.size()) ;
       nums.add(x) ;
       hash.put(x, y) ;
       return !ans;
    }

    /** Removes a value from the collection. Returns true if the collection contained the specified element. */
    public boolean remove(int val) {
        if (!hash.containsKey(val)) return false ;
        int loc = hash.get(val).iterator().next() ;
        hash.get(val).remove(loc);
        if (hash.get(val).size() == 0) hash.remove(val);
        if (loc < nums.size() - 1) {
            int j = nums.size() - 1 ;
            int target = nums.get(j) ;
            Collections.swap(nums, loc, j) ;            
            hash.get(target).add(loc);
            hash.get(target).remove(j);            
        }
        nums.remove(nums.size() - 1) ;
        return true ;
    }

    /** Get a random element from the collection. */
    public int getRandom() {
        int idx = rand.nextInt(nums.size());
        return nums.get(idx) ;
    }
}
```

